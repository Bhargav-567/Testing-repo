{% extends 'base.html' %}

{% block title %}Upload Questions - Exam System{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-3xl font-bold mb-2 text-gray-800">ðŸ“¤ Upload Questions</h2>
        <p class="text-gray-600 mb-6">Upload an Excel (.xlsx) or CSV file with your exam questions</p>
        
        <div class="bg-gradient-to-b from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-6 mb-8 shadow-sm">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-blue-800 flex items-center">
                    ðŸ“‹ Required Excel Structure
                </h3>
                {% load static %}
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-blue-800 flex items-center">
                            ðŸ“‹ Required Excel Structure
                        </h3>
                        <a href="{% static 'sample/PowerPlant_Exam_Sample.xlsx' %}" 
                        download="PowerPlant_Sample.xlsx"
                        class="bg-white border border-blue-500 text-blue-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-50 transition flex items-center gap-2">
                            ðŸ“¥ Download Power Plant Sample
                        </a>
                    </div>
            </div>
            
            <div class="overflow-x-auto bg-white rounded-xl shadow-inner border border-blue-100">
                <table class="w-full text-xs text-left">
                    <thead class="bg-blue-600 text-white">
                        <tr>
                            <th class="px-3 py-2">Q_ID</th>
                            <th class="px-3 py-2">Question</th>
                            <th class="px-3 py-2">Type</th>
                            <th class="px-3 py-2">Teacher_Answer</th>
                            <th class="px-3 py-2">Max_Score</th>
                            <th class="px-3 py-2 bg-emerald-600">Concept_Names</th>
                            <th class="px-3 py-2 bg-emerald-600">Concept_Keywords</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-100">
                        <tr>
                            <td class="px-3 py-3 font-bold">Q1</td>
                            <td class="px-3 py-3">Explain Rankine cycle...</td>
                            <td class="px-3 py-3 font-semibold text-blue-600">descriptive</td>
                            <td class="px-3 py-3 italic text-gray-500">The cycle uses...</td>
                            <td class="px-3 py-3 font-bold">10.0</td>
                            <td class="px-3 py-3 bg-emerald-50 text-emerald-800">Rankine, Condenser</td>
                            <td class="px-3 py-3 bg-emerald-50 text-emerald-800">rankine,cycle; condenser,cool</td>
                        </tr>
                        <tr>
                            <td class="px-3 py-3 font-bold">Q2</td>
                            <td class="px-3 py-3">Function of Economizer?</td>
                            <td class="px-3 py-3 font-semibold text-orange-600">mcq</td>
                            <td class="px-3 py-3 font-semibold">Heat Feed Water</td>
                            <td class="px-3 py-3 font-bold">1.0</td>
                            <td class="px-3 py-3 text-gray-300">--</td>
                            <td class="px-3 py-3 text-gray-300">--</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p class="text-xs text-blue-600 mt-3 italic">**Note:** Use <b>semicolon (;)</b> to separate different concept keyword groups.</p>
        </div>

        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Exam Code:</label>
                    <input type="text" name="exam_code" placeholder="e.g. MECH-2024-01" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>

                <div>
                    <label class="block text-gray-700 font-semibold mb-2">Duration (minutes):</label>
                    <input type="number" name="duration" value="60" min="1" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                </div>
            </div>

            <div>
                <label class="block text-gray-700 font-semibold mb-2">Select Excel/CSV File:</label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition cursor-pointer bg-gray-50 relative">
                    <input type="file" name="file" accept=".xlsx,.xls,.csv" required
                           class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                    <p class="text-gray-500">Click to browse or drag and drop your file here</p>
                    <p class="text-xs text-blue-500 font-bold mt-2">.xlsx, .xls, .csv supported</p>
                </div>
            </div>
            
            <div class="flex gap-4 pt-4">
                <button type="submit" class="flex-1 bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 shadow-lg transition">
                    ðŸš€ Start Processing & Upload
                </button>
                <a href="{% url 'admin_dashboard' %}" class="px-8 bg-gray-100 text-gray-600 py-4 rounded-xl font-bold hover:bg-gray-200 transition text-center">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
function downloadSampleExcel() {
    const data = [
        ["Q_ID", "Question", "Type", "Options", "Teacher_Answer", "Max_Score", "Concept_Names", "Concept_Keywords"],
        ["Q1", "Explain the Rankine cycle and the importance of the condenser in a thermal power plant.", "descriptive", "", "The Rankine cycle uses a boiler to create steam which spins a turbine. The condenser cools the steam back to water.", 10, "Rankine Cycle, Condenser", "rankine,cycle; condenser,cools,cooling"],
        ["Q2", "Which part of the steam power plant is known as the 'heart'?", "mcq", "Boiler|Turbine|Condenser|Pump", "Boiler", 1, "", ""],
        ["Q3", "Function of an Economizer?", "mcq", "Heat air|Heat feed water|Superheat steam|Condense steam", "Heat feed water", 1, "", ""],
        ["Q4", "Moderator in Nuclear Reactors?", "mcq", "Boron|Graphite|Cadmium|Copper", "Graphite", 1, "", ""],
        ["Q5", "Pelton wheel head type?", "mcq", "Low|Medium|High|All", "High", 1, "", ""]
    ];
    
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet(data);
    XLSX.utils.book_append_sheet(wb, ws, "PowerPlantSample");
    XLSX.writeFile(wb, "PowerPlant_Exam_Sample.xlsx");
}
</script>
{% endblock %}